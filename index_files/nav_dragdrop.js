$(function(){var f=$(".nav-items").disableSelection(),c=$("#room-more ul:first"),d=650,a=function(){var j=0,i,h,g;i=c.find("li:first");h=i.clone().css("visibility","hidden");g=f.find("ul:first").append(h);f.find("ul:first>li:not(.opt)").each(function(k,l){j+=l.offsetWidth});h.remove();if(j<d){i.insertBefore(c.parent())}},b=function(){$("li:not(.opt)",f).draggable("option","cursorAt",false);$("#room-more ul li").each(function(g,h){$(h).draggable("option","cursorAt",{right:Math.floor($(h).text().replace(/\s/g,"").length*12/2)})})},e=function(){var i=[],g=[],h="/j/site/{ID}/admin/layout",j;if(typeof mine_page_url==="undefined"){if(self.location.href.search(/\/room\//)+1){j=self.location.href.match(/\/([^/]+)\/room/)[1]}else{j=self.location.href.replace("http://","").match(/\/([^/]+)/)[1]}}else{j=mine_page_url.match(/site\/([^/]+)/)[1]}f.find("ul:first>li:not(.opt)>a").each(function(k,l){i.push(l.getAttribute("href").match(/room\/(\d+|[^/]+)/)[1])});c.find("li>a").each(function(k,l){g.push(l.getAttribute("href").match(/room\/(\d+|[^/]+)/)[1])});$.post(h.replace("{ID}",j),{tabs:i.slice(0,i.length-1).join(",")+","+g.join(","),ck:get_cookie("ck")})};$("li:not(.opt)",f).draggable({helper:"clone",axis:"x",opacity:0.8,appendTo:".nav-items ul:first",refreshPositions:true,start:function(j,i){var h=$(this),g=j.clientX;h.css({opacity:0,whiteSpace:"nowrap"});if(c.length>0&&$.contains(c[0],this)){h.draggable("option","axis",false)}i.helper.css({zIndex:999,border:"none",whiteSpace:"nowrap"})},stop:function(){$(this).css({opacity:1,width:"auto"}).draggable("option","axis","x");e();b()}}).droppable({over:function(k,i){var g=$("#nav-items-mark"),j=200,h=i.helper.width();if(g.length===0){g=$('<li id="nav-items-mark" style="width:0;overflow:hidden;visibility:hidden;">')}g.stop().css("width",0).show();i.draggable.css("opacity",0).stop();if(c.length>0&&$.contains(c[0],i.draggable[0])){g.hide();i.draggable.insertBefore(this);return}i.draggable.animate({width:0},j);if(i.draggable.offset().left<$(this).offset().left){g.insertAfter(this).animate({width:h},j,function(){i.draggable.css("width","auto").insertBefore(this);this.style.display="none"})}else{g.insertBefore(this).animate({width:h},j,function(){i.draggable.css("width","auto").insertBefore(this);this.style.display="none"})}},drop:function(j,i){var h=0,g;f.find("ul:first>li:not(.opt)").each(function(k,l){h+=l.offsetWidth});if(h>d){g=c.parent().prev();if(g.hasClass("on")){g=g.prev()}g.insertBefore(c.find("li:first"))}}});$("#room-more").droppable({tolerance:"touch",over:function(h,g){$(this).css("opacity",0.8)},out:function(){$(this).css("opacity",1)},drop:function(j,i){var h=i.draggable,g=$(this);g.css("opacity",1);if(h.hasClass("on")||i.helper.offset().left<$(this).offset().left){return}g.find("ul:first").append(h);a()}});$("#room-admin li").draggable("option","disabled",true);b()});